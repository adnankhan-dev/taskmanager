<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <title>{{ title or "UW Task Manager" }}</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <!-- Bootstrap CSS -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <link rel="icon" type="image/svg+xml" href="{{ url_for('static', path='img/favicon.svg') }}">

  <!-- Chart.js (for dashboard graphs â€“ will be used later) -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

  {% set active_theme = request.state.ui_theme if request and request.state.ui_theme else 'classic' %}
  {% set btn_colors = request.state.ui_button_colors if request and request.state.ui_button_colors else {} %}
  <style>
    :root {
      --tm-body-bg: #f4f6f9;
      --tm-nav-start: #0b1b2b;
      --tm-nav-end: #152c48;
      --tm-footer-start: #0b1b2b;
      --tm-footer-end: #152c48;
      --tm-nav-text: #dbe7ff;
      --tm-nav-active-bg: #ffffff;
      --tm-nav-active-text: #0b1b2b;
      --tm-page-text: #212529;
      --tm-surface-bg: #ffffff;
      --tm-surface-soft-bg: #f8f9fa;
      --tm-border: #dee2e6;
      --tm-muted: #6c757d;
      --tm-dropdown-bg: #ffffff;
      --tm-dropdown-text: #212529;
      --tm-dropdown-hover-bg: #f1f3f5;
      --tm-btn-primary: {{ btn_colors.get('ui_btn_primary', '#0d6efd') }};
      --tm-btn-secondary: {{ btn_colors.get('ui_btn_secondary', '#6c757d') }};
      --tm-btn-success: {{ btn_colors.get('ui_btn_success', '#198754') }};
      --tm-btn-warning: {{ btn_colors.get('ui_btn_warning', '#ffc107') }};
      --tm-btn-danger: {{ btn_colors.get('ui_btn_danger', '#dc3545') }};
    }
    {% if active_theme == "ocean" %}
    :root {
      --tm-body-bg: #eef6f8;
      --tm-nav-start: #0b2b34;
      --tm-nav-end: #1a4b56;
      --tm-footer-start: #0b2b34;
      --tm-footer-end: #1a4b56;
      --tm-nav-text: #d8f0f4;
      --tm-nav-active-bg: #e8fbff;
      --tm-nav-active-text: #0b2b34;
    }
    {% elif active_theme == "emerald" %}
    :root {
      --tm-body-bg: #f2f8f3;
      --tm-nav-start: #153a2f;
      --tm-nav-end: #235b4a;
      --tm-footer-start: #153a2f;
      --tm-footer-end: #235b4a;
      --tm-nav-text: #dbf3e6;
      --tm-nav-active-bg: #eefcf3;
      --tm-nav-active-text: #153a2f;
    }
    {% endif %}

    html, body {
      height: 100%;
    }
    body {
      font-size: 0.95rem;
      background-color: var(--tm-body-bg);
      color: var(--tm-page-text);
      min-height: 100%;
      display: flex;
      flex-direction: column;
    }

    .navbar-brand span {
      font-size: 0.75rem;
    }
    .navbar-brand small {
      font-size: 0.7rem;
      display: block;
    }

    .page-header {
      margin-bottom: 1.5rem;
    }

    .card {
      border: none;
      border-radius: 0.75rem;
      background-color: var(--tm-surface-bg);
      color: var(--tm-page-text);
    }
    .card-hover {
      transition: transform 0.15s ease, box-shadow 0.15s ease;
    }
    .card-hover:hover {
      transform: translateY(-2px);
      box-shadow: 0 8px 16px rgba(0,0,0,0.08);
    }
    .stat-card {
      border: 0;
      color: #fff;
      border-radius: 1rem;
      position: relative;
      overflow: hidden;
    }
    .stat-card::after {
      content: "";
      position: absolute;
      top: -30px;
      right: -30px;
      width: 120px;
      height: 120px;
      background: rgba(255,255,255,0.14);
      border-radius: 50%;
    }
    .stat-title {
      font-size: 0.7rem;
      text-transform: uppercase;
      letter-spacing: 0.08em;
      opacity: 0.9;
    }
    .stat-value {
      font-size: 1.9rem;
      font-weight: 700;
      line-height: 1.1;
    }
    .stat-link {
      font-size: 0.75rem;
      opacity: 0.9;
    }
    .stat-primary { background: linear-gradient(135deg, #0d6efd, #4d9bff); }
    .stat-info { background: linear-gradient(135deg, #0dcaf0, #0b7fab); }
    .stat-warning { background: linear-gradient(135deg, #b7791f, #f6ad55); }
    .stat-danger { background: linear-gradient(135deg, #dc3545, #8b1d28); }
    .navbar-modern {
      background: linear-gradient(90deg, var(--tm-nav-start), var(--tm-nav-end));
      border-bottom: 1px solid rgba(255,255,255,0.08);
    }
    .footer-modern {
      background: linear-gradient(90deg, var(--tm-footer-start), var(--tm-footer-end));
      border-top: 1px solid rgba(255,255,255,0.08);
      color: var(--tm-nav-text);
    }
    .footer-modern .footer-text {
      font-size: 0.78rem;
    }
    .footer-modern .footer-links {
      white-space: nowrap;
      font-size: 0.78rem;
    }
    .footer-modern a {
      color: var(--tm-nav-text);
      text-decoration: none;
    }
    .footer-modern a:hover {
      color: #ffffff;
      text-decoration: underline;
    }
    .nav-pill {
      padding: 0.35rem 0.85rem;
      border-radius: 999px;
      color: var(--tm-nav-text) !important;
      transition: all 0.15s ease;
    }
    .nav-pill:hover {
      background: rgba(255,255,255,0.12);
      color: #fff !important;
    }
    .nav-pill.active {
      background: var(--tm-nav-active-bg);
      color: var(--tm-nav-active-text) !important;
      font-weight: 600;
    }
    .nav-cta {
      border-radius: 999px;
      padding: 0.35rem 0.9rem;
    }

    .table {
      --bs-table-bg: var(--tm-surface-bg);
      --bs-table-color: var(--tm-page-text);
      --bs-table-border-color: var(--tm-border);
    }
    .table-light {
      --bs-table-bg: var(--tm-surface-soft-bg);
      --bs-table-color: var(--tm-page-text);
      --bs-table-border-color: var(--tm-border);
    }
    .bg-white {
      background-color: var(--tm-surface-bg) !important;
      color: var(--tm-page-text) !important;
    }
    .text-muted {
      color: var(--tm-muted) !important;
    }
    .form-control,
    .form-select {
      background-color: var(--tm-surface-bg);
      border-color: var(--tm-border);
      color: var(--tm-page-text);
    }
    .form-control::placeholder {
      color: var(--tm-muted);
    }
    .form-control:focus,
    .form-select:focus {
      background-color: var(--tm-surface-bg);
      color: var(--tm-page-text);
    }
    .dropdown-menu {
      background-color: var(--tm-dropdown-bg);
      color: var(--tm-dropdown-text);
      border-color: var(--tm-border);
    }
    .dropdown-item {
      color: var(--tm-dropdown-text);
    }
    .dropdown-item:hover,
    .dropdown-item:focus {
      background-color: var(--tm-dropdown-hover-bg);
      color: var(--tm-dropdown-text);
    }
    .dropdown-divider {
      border-color: var(--tm-border);
    }

    body[data-mode="dark"] {
      --tm-body-bg: #0f172a;
      --tm-nav-start: #060b16;
      --tm-nav-end: #111827;
      --tm-footer-start: #060b16;
      --tm-footer-end: #111827;
      --tm-nav-text: #dbe3f0;
      --tm-nav-active-bg: #1f2937;
      --tm-nav-active-text: #f8fafc;
      --tm-page-text: #e5e7eb;
      --tm-surface-bg: #111827;
      --tm-surface-soft-bg: #1f2937;
      --tm-border: #334155;
      --tm-muted: #94a3b8;
      --tm-dropdown-bg: #0f172a;
      --tm-dropdown-text: #e5e7eb;
      --tm-dropdown-hover-bg: #1e293b;
    }

    .btn-primary {
      background-color: var(--tm-btn-primary) !important;
      border-color: var(--tm-btn-primary) !important;
      color: #fff !important;
    }
    .btn-secondary {
      background-color: var(--tm-btn-secondary) !important;
      border-color: var(--tm-btn-secondary) !important;
      color: #fff !important;
    }
    .btn-success {
      background-color: var(--tm-btn-success) !important;
      border-color: var(--tm-btn-success) !important;
      color: #fff !important;
    }
    .btn-warning {
      background-color: var(--tm-btn-warning) !important;
      border-color: var(--tm-btn-warning) !important;
      color: #212529 !important;
    }
    .btn-danger {
      background-color: var(--tm-btn-danger) !important;
      border-color: var(--tm-btn-danger) !important;
      color: #fff !important;
    }

    .btn-outline-primary {
      color: var(--tm-btn-primary) !important;
      border-color: var(--tm-btn-primary) !important;
    }
    .btn-outline-secondary {
      color: var(--tm-btn-secondary) !important;
      border-color: var(--tm-btn-secondary) !important;
    }
    .btn-outline-success {
      color: var(--tm-btn-success) !important;
      border-color: var(--tm-btn-success) !important;
    }
    .btn-outline-warning {
      color: var(--tm-btn-warning) !important;
      border-color: var(--tm-btn-warning) !important;
    }
    .btn-outline-danger {
      color: var(--tm-btn-danger) !important;
      border-color: var(--tm-btn-danger) !important;
    }

    .btn-outline-primary:hover, .btn-outline-primary:focus, .btn-outline-primary:active {
      background-color: var(--tm-btn-primary) !important;
      border-color: var(--tm-btn-primary) !important;
      color: #fff !important;
    }
    .btn-outline-secondary:hover, .btn-outline-secondary:focus, .btn-outline-secondary:active {
      background-color: var(--tm-btn-secondary) !important;
      border-color: var(--tm-btn-secondary) !important;
      color: #fff !important;
    }
    .btn-outline-success:hover, .btn-outline-success:focus, .btn-outline-success:active {
      background-color: var(--tm-btn-success) !important;
      border-color: var(--tm-btn-success) !important;
      color: #fff !important;
    }
    .btn-outline-warning:hover, .btn-outline-warning:focus, .btn-outline-warning:active {
      background-color: var(--tm-btn-warning) !important;
      border-color: var(--tm-btn-warning) !important;
      color: #212529 !important;
    }
    .btn-outline-danger:hover, .btn-outline-danger:focus, .btn-outline-danger:active {
      background-color: var(--tm-btn-danger) !important;
      border-color: var(--tm-btn-danger) !important;
      color: #fff !important;
    }

    .btn-primary:hover, .btn-primary:focus, .btn-primary:active,
    .btn-secondary:hover, .btn-secondary:focus, .btn-secondary:active,
    .btn-success:hover, .btn-success:focus, .btn-success:active,
    .btn-warning:hover, .btn-warning:focus, .btn-warning:active,
    .btn-danger:hover, .btn-danger:focus, .btn-danger:active {
      filter: brightness(0.92);
    }

    .card-shadow {
      box-shadow: 0 4px 12px rgba(0,0,0,0.06);
    }

    .overdue {
      background-color: #fff3f3;
    }
  </style>
  <!-- Chart.js -->
<script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>

</head>

<body>

<!-- ================= NAVBAR ================= -->
<nav class="navbar navbar-expand-lg navbar-dark navbar-modern shadow-sm">
  <div class="container">

    <!-- Brand -->
    <a class="navbar-brand fw-semibold d-flex align-items-center gap-2" href="/dashboard">
      <img src="{{ url_for('static', path='img/uw-logo.svg') }}"
           alt="UW Logo"
           width="34"
           height="34"
           class="rounded bg-light p-1">
      <div class="d-flex flex-column lh-sm">
        <span>Task Manager</span>
        <small class="text-light opacity-75">Directorate of Academics, Advanced Studies and Research</small>
      </div>
    </a>

    <!-- Mobile Toggle -->
    <button class="navbar-toggler" type="button"
            data-bs-toggle="collapse"
            data-bs-target="#mainNavbar">
      <span class="navbar-toggler-icon"></span>
    </button>

    <!-- Navbar Content -->
    <div class="collapse navbar-collapse" id="mainNavbar">

      <!-- LEFT MENU -->
      <ul class="navbar-nav me-auto gap-2">

        <li class="nav-item">
          <a class="nav-link nav-pill {% if request.url.path == '/dashboard' %}active{% endif %}"
             href="/dashboard">
            Dashboard
          </a>
        </li>

        <li class="nav-item">
          <a class="nav-link nav-pill {% if request.url.path.startswith('/ui/tasks') %}active{% endif %}"
             href="/ui/tasks">
            Tasks
          </a>
        </li>

        <li class="nav-item">
          <a class="nav-link nav-pill {% if request.url.path.startswith('/ui/quick-tasks') %}active{% endif %}"
             href="/ui/quick-tasks">
            Quick Logs
          </a>
        </li>

        {% if user and user.role == "admin" %}
        <li class="nav-item dropdown">
          <a class="nav-link nav-pill dropdown-toggle {% if request.url.path.startswith('/ui/task-types') or request.url.path.startswith('/ui/users') or request.url.path.startswith('/ui/admin') %}active{% endif %}"
             href="#"
             role="button"
             data-bs-toggle="dropdown"
             aria-expanded="false">
            Admin
          </a>
          <ul class="dropdown-menu">
            <li>
              <a class="dropdown-item {% if request.url.path.startswith('/ui/task-types') %}active{% endif %}"
                 href="/ui/task-types">
                Task Types
              </a>
            </li>
            <li>
              <a class="dropdown-item {% if request.url.path.startswith('/ui/users') %}active{% endif %}"
                 href="/ui/users">
                Users
              </a>
            </li>
            <li>
              <a class="dropdown-item {% if request.url.path.startswith('/ui/admin/theme') %}active{% endif %}"
                 href="/ui/admin/theme">
                Theme
              </a>
            </li>
          </ul>
        </li>
        {% endif %}

      </ul>

      <!-- RIGHT MENU -->
      {% if user %}
      <ul class="navbar-nav ms-auto align-items-lg-center gap-2">

        <li class="nav-item me-lg-2">
          <a class="nav-link nav-pill {% if request.url.path.startswith('/ui/reports') %}active{% endif %}"
             href="/ui/reports">
            Reports
          </a>
        </li>

        <li class="nav-item dropdown">
          <a class="nav-link nav-pill dropdown-toggle" href="#" role="button"
             data-bs-toggle="dropdown" aria-expanded="false">
            {{ user.username }}
          </a>
          <ul class="dropdown-menu dropdown-menu-end">
            <li>
              <button type="button" class="dropdown-item" id="theme-mode-toggle">
                <span id="theme-mode-toggle-text">Switch to Dark Mode</span>
              </button>
            </li>
            <li><hr class="dropdown-divider"></li>
            <li>
              <a class="dropdown-item" href="/logout">Logout</a>
            </li>
          </ul>
        </li>

      </ul>
      {% endif %}

    </div>
  </div>
</nav>
<!-- =============== END NAVBAR =============== -->


<!-- ================= MAIN CONTENT ================= -->
<main class="container my-4 flex-grow-1">

  {% block page_header %}{% endblock %}

  <div class="card card-shadow p-4">
    {% block content %}{% endblock %}
  </div>

</main>
<!-- =============== END MAIN CONTENT =============== -->

<!-- ================= FOOTER ================= -->
<footer class="mt-4 py-2 footer-modern">
  <div class="container footer-text opacity-75">
    <div class="row align-items-center g-2">
      <div class="col-12 col-md-3 text-center text-md-start">
        Directorate of Academics, Advanced Studies and research
      </div>
      <div class="col-12 col-md-4 text-center">
        Developed by Adnan Khan | &copy; 2026 All rights reserved
      </div>
      <div class="col-12 col-md-5 text-center text-md-end footer-links">
        <a href="https://uow.edu.pk" target="_blank" rel="noopener">University of wah</a>
        <span class="mx-1">|</span>
        <a href="http://192.168.3.50:2015" target="_blank" rel="noopener">Avicenna (In Campus)</a>
        <span class="mx-1">|</span>
        <a href="http://111.68.98.212:2015" target="_blank" rel="noopener">Avicenna (Off Campus)</a>
      </div>
    </div>
  </div>
</footer>
<!-- =============== END FOOTER =============== -->


<!-- Bootstrap JS -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
<script>
  (function () {
    const STORAGE_KEY = "ui_mode";
    const body = document.body;

    function applyMode(mode) {
      body.setAttribute("data-mode", mode);
      const label = document.getElementById("theme-mode-toggle-text");
      if (label) {
        label.textContent = mode === "dark"
          ? "Switch to Light Mode"
          : "Switch to Dark Mode";
      }
    }

    function getInitialMode() {
      const saved = window.localStorage.getItem(STORAGE_KEY);
      if (saved === "dark" || saved === "light") {
        return saved;
      }
      return "light";
    }

    applyMode(getInitialMode());

    const toggleBtn = document.getElementById("theme-mode-toggle");
    if (!toggleBtn) {
      return;
    }

    toggleBtn.addEventListener("click", function () {
      const current = body.getAttribute("data-mode") === "dark" ? "dark" : "light";
      const next = current === "dark" ? "light" : "dark";
      window.localStorage.setItem(STORAGE_KEY, next);
      applyMode(next);
    });
  })();
</script>

</body>
</html>
